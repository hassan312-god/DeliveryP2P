# Configuration Apache globale pour LivraisonP2P
# Redirections et gestion des routes

RewriteEngine On

# Redirection des requêtes API
RewriteCond %{REQUEST_URI} ^/api/
RewriteRule ^api/(.*)$ api/index.php [QSA,L]

# Redirection du health check
RewriteCond %{REQUEST_URI} ^/health$
RewriteRule ^health$ api/health.php [QSA,L]

# Redirection du test de connexion
RewriteCond %{REQUEST_URI} ^/test-connection$
RewriteRule ^test-connection$ api/test-connection.php [QSA,L]

# Redirection vers le frontend pour toutes les autres requêtes
RewriteCond %{REQUEST_URI} !^/api/
RewriteCond %{REQUEST_URI} !^/health$
RewriteCond %{REQUEST_URI} !^/test-connection$
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ frontend/index.html [QSA,L]

# Protection des fichiers sensibles
<Files "*.env">
    Order allow,deny
    Deny from all
</Files>

<Files "*.log">
    Order allow,deny
    Deny from all
</Files>

<Files "composer.*">
    Order allow,deny
    Deny from all
</Files>

<Files "Dockerfile">
    Order allow,deny
    Deny from all
</Files>

<Files "start.sh">
    Order allow,deny
    Deny from all
</Files> 